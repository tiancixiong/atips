"use strict";(self.webpackChunkatips=self.webpackChunkatips||[]).push([[5903],{5275:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-13c636e4",path:"/devops/docker/docker-deploy-on-Linux.html",title:"Docker使用 - 在Linux环境中部署",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"Docker环境安装",slug:"docker环境安装",children:[]},{level:2,title:"Mysql安装",slug:"mysql安装",children:[]},{level:2,title:"Redis安装",slug:"redis安装",children:[]},{level:2,title:"Nginx安装",slug:"nginx安装",children:[{level:3,title:"下载nginx1.10的docker镜像",slug:"下载nginx1-10的docker镜像",children:[]},{level:3,title:"从容器中拷贝nginx配置",slug:"从容器中拷贝nginx配置",children:[]},{level:3,title:"使用docker命令启动：",slug:"使用docker命令启动",children:[]}]},{level:2,title:"RabbitMQ安装",slug:"rabbitmq安装",children:[]},{level:2,title:"Elasticsearch安装",slug:"elasticsearch安装",children:[]},{level:2,title:"kibana安装",slug:"kibana安装",children:[]},{level:2,title:"Mongodb安装",slug:"mongodb安装",children:[]},{level:2,title:"部署SpringBoot应用",slug:"部署springboot应用",children:[{level:3,title:"构建所有Docker镜像并上传",slug:"构建所有docker镜像并上传",children:[]}]},{level:2,title:"参考资料",slug:"参考资料",children:[]}],filePathRelative:"devops/docker/docker-deploy-on-Linux.md",git:{updatedTime:1719836412e3,contributors:[{name:"Tianci.Xiong",email:"tiancixiong@163.com",commits:3},{name:"TianCi.Xiong",email:"tiancixiong@163.com",commits:1}]}}},6253:(s,n,a)=>{a.r(n),a.d(n,{default:()=>q});var e=a(6252);const l=(0,e.uE)('<h1 id="docker使用-在linux环境中部署" tabindex="-1"><a class="header-anchor" href="#docker使用-在linux环境中部署" aria-hidden="true">#</a> Docker使用 - 在Linux环境中部署</h1><blockquote><p>此案例使用的环境：centos-release-7-3.1611.el7.centos.x86_64</p></blockquote><blockquote><p>尽量使用 CentOS 7 进行安装</p></blockquote><h2 id="docker环境安装" tabindex="-1"><a class="header-anchor" href="#docker环境安装" aria-hidden="true">#</a> Docker环境安装</h2><ul><li>安装yum-utils：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>为yum源添加docker仓库位置：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>安装docker：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> docker-ce\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>启动docker：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl start docker\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="mysql安装" tabindex="-1"><a class="header-anchor" href="#mysql安装" aria-hidden="true">#</a> Mysql安装</h2><ul><li>下载mysql5.7的docker镜像：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull mysql:5.7\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用docker命令启动：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">3306</span>:3306 --name mysql <span class="token punctuation">\\</span>\n-v /mydata/mysql/log:/var/log/mysql <span class="token punctuation">\\</span>\n-v /mydata/mysql/data:/var/lib/mysql <span class="token punctuation">\\</span>\n-v /mydata/mysql/conf:/etc/mysql <span class="token punctuation">\\</span>\n-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root <span class="token punctuation">\\</span>\n-d mysql:5.7\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>参数说明</p><ul><li><p>-p 3306:3306：将容器的3306端口映射到主机的3306端口</p></li><li><p>-v /mydata/mysql/conf:/etc/mysql：将配置文件夹挂在到主机</p></li><li><p>-v /mydata/mysql/log:/var/log/mysql：将日志文件夹挂载到主机</p></li><li><p>-v /mydata/mysql/data:/var/lib/mysql/：将数据文件夹挂载到主机</p></li><li><p>-e MYSQLROOTPASSWORD=root：初始化root用户的密码</p></li></ul></li><li><p>进入运行mysql的docker容器：</p></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>docker exec -it mysql /bin/bash\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用mysql命令打开客户端：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql -uroot -proot --default-character-set<span class="token operator">=</span>utf8mb4\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>创建mall数据库：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> create database mall character <span class="token builtin class-name">set</span> utf8mb4<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><p>安装上传下载插件，并将docment/sql/mall.sql上传到Linux服务器上：</p><p>lrzsz是一款程序，在linux中可以代替ftp的上传和下载</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> lrzsz\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>本地文件上传到服务器：<code>rz</code></li><li>服务器文件发送到本地，文件会默认下载到系统的Downloads目录 C:Users[用户名]\\Downloads：<code>sz 文件名</code></li></ul></li><li><p>将mall.sql文件拷贝到mysql容器的/目录下：</p></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker <span class="token function">cp</span> /mydata/mall.sql mysql:/\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>将sql文件导入到数据库：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> use mall<span class="token punctuation">;</span>\nmysql<span class="token operator">&gt;</span> <span class="token builtin class-name">source</span> /mall.sql<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>创建一个reader帐号并修改权限，使得任何ip都能访问：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> grant all privileges on *.* to <span class="token string">&#39;reader&#39;</span> @<span class="token string">&#39;%&#39;</span> identified by <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="redis安装" tabindex="-1"><a class="header-anchor" href="#redis安装" aria-hidden="true">#</a> Redis安装</h2><ul><li>下载redis3.2的docker镜像：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull redis:3.2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用docker命令启动：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">6379</span>:6379 --name redis <span class="token punctuation">\\</span>\n-v /mydata/redis/data:/data <span class="token punctuation">\\</span>\n-d redis:3.2 redis-server --appendonly <span class="token function">yes</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>进入redis容器使用redis-cli命令进行连接：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker <span class="token builtin class-name">exec</span> -it redis redis-cli\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="nginx安装" tabindex="-1"><a class="header-anchor" href="#nginx安装" aria-hidden="true">#</a> Nginx安装</h2><h3 id="下载nginx1-10的docker镜像" tabindex="-1"><a class="header-anchor" href="#下载nginx1-10的docker镜像" aria-hidden="true">#</a> 下载nginx1.10的docker镜像</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull nginx:1.10\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="从容器中拷贝nginx配置" tabindex="-1"><a class="header-anchor" href="#从容器中拷贝nginx配置" aria-hidden="true">#</a> 从容器中拷贝nginx配置</h3><ul><li>先运行一次容器（为了拷贝配置文件）：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">80</span>:80 --name nginx <span class="token punctuation">\\</span>\n-v /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\\</span>\n-v /mydata/nginx/logs:/var/log/nginx <span class="token punctuation">\\</span>\n-d nginx:1.10\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>将容器内的配置文件拷贝到指定目录：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker container <span class="token function">cp</span> nginx:/etc/nginx /mydata/nginx/\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>修改文件名称：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mv</span> nginx conf\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>终止并删除容器：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker stop nginx\ndocker <span class="token function">rm</span> nginx\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="使用docker命令启动" tabindex="-1"><a class="header-anchor" href="#使用docker命令启动" aria-hidden="true">#</a> 使用docker命令启动：</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">80</span>:80 --name nginx <span class="token punctuation">\\</span>\n-v /mydata/nginx/html:/usr/share/nginx/html <span class="token punctuation">\\</span>\n-v /mydata/nginx/logs:/var/log/nginx <span class="token punctuation">\\</span>\n-v /mydata/nginx/conf:/etc/nginx <span class="token punctuation">\\</span>\n-d nginx:1.10\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="rabbitmq安装" tabindex="-1"><a class="header-anchor" href="#rabbitmq安装" aria-hidden="true">#</a> RabbitMQ安装</h2><ul><li>下载rabbitmq3.7.15的docker镜像：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull rabbitmq:3.7.15\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用docker命令启动：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -d --name rabbitmq <span class="token punctuation">\\</span>\n--publish <span class="token number">5671</span>:5671 --publish <span class="token number">5672</span>:5672 --publish <span class="token number">4369</span>:4369 <span class="token punctuation">\\</span>\n--publish <span class="token number">25672</span>:25672 --publish <span class="token number">15671</span>:15671 --publish <span class="token number">15672</span>:15672 <span class="token punctuation">\\</span>\nrabbitmq:3.7.15\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>进入容器并开启管理功能：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker <span class="token builtin class-name">exec</span> -it rabbitmq /bin/bash\nrabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_management\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>开启防火墙：</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>firewall-cmd --zone=public --add-port=15672/tcp --permanent\nfirewall-cmd --reload\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>访问地址查看是否安装成功：http://ip:15672/</p></li><li><p>输入账号密码并登录：guest guest</p></li></ul><h2 id="elasticsearch安装" tabindex="-1"><a class="header-anchor" href="#elasticsearch安装" aria-hidden="true">#</a> Elasticsearch安装</h2><ul><li>下载elasticsearch6.4.0的docker镜像：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull elasticsearch:6.4.0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>修改虚拟内存区域大小，否则会因为过小而无法启动:</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sysctl -w vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用docker命令启动：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">9200</span>:9200 -p <span class="token number">9300</span>:9300 --name elasticsearch <span class="token punctuation">\\</span>\n-e <span class="token string">&quot;discovery.type=single-node&quot;</span> <span class="token punctuation">\\</span>-e <span class="token string">&quot;cluster.name=elasticsearch&quot;</span> <span class="token punctuation">\\</span>\n-v /mydata/elasticsearch/plugins:/usr/share/elasticsearch/plugins <span class="token punctuation">\\</span>\n-v /mydata/elasticsearch/data:/usr/share/elasticsearch/data <span class="token punctuation">\\</span>\n-d elasticsearch:6.4.0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>启动时会发现 <code>/usr/share/elasticsearch/data</code> 目录没有访问权限，只需要修改 <code>/mydata/elasticsearch/data</code> 目录的权限，再重新启动。</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token number">777</span> /mydata/elasticsearch/data/\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',69),i=(0,e._)("p",null,"ik 分词器插件",-1),r=(0,e.Uk)("下载地址："),c={href:"https://github.com/medcl/elasticsearch-analysis-ik/releases",target:"_blank",rel:"noopener noreferrer"},p=(0,e.Uk)("Releases · medcl/elasticsearch-analysis-ik"),d=(0,e.uE)('<p>安装中文分词器IKAnalyzer，并重新启动：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker <span class="token builtin class-name">exec</span> -it elasticsearch /bin/bash\n<span class="token comment"># 此命令需要在容器中运行</span>\nelasticsearch-plugin <span class="token function">install</span> https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.4.0/elasticsearch-analysis-ik-6.4.0.zip\n\n<span class="token builtin class-name">exit</span>\ndocker restart elasticsearch\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>',2),u=(0,e._)("li",null,[(0,e._)("p",null,"开启防火墙：")],-1),o=(0,e.uE)('<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">9200</span>/tcp --permanent\nfirewall-cmd --reload\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>访问会返回版本信息：http://ip:9200/</li></ul><h2 id="kibana安装" tabindex="-1"><a class="header-anchor" href="#kibana安装" aria-hidden="true">#</a> kibana安装</h2><ul><li>下载kibana6.4.0的docker镜像：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull kibana:6.4.0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用docker命令启动：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run --name kibana -p <span class="token number">5601</span>:5601 <span class="token punctuation">\\</span>\n--link elasticsearch:es <span class="token punctuation">\\</span>\n-e <span class="token string">&quot;elasticsearch.hosts=http://es:9200&quot;</span> <span class="token punctuation">\\</span>\n-d kibana:6.4.0\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>开启防火墙：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">5601</span>/tcp --permanent\nfirewall-cmd --reload\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>访问地址进行测试：http://ip:5601</li></ul><h2 id="mongodb安装" tabindex="-1"><a class="header-anchor" href="#mongodb安装" aria-hidden="true">#</a> Mongodb安装</h2><ul><li>下载mongo3.2的docker镜像：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker pull mongo:3.2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用docker命令启动：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">27017</span>:27017 --name mongo <span class="token punctuation">\\</span>\n-v /mydata/mongo/db:/data/db <span class="token punctuation">\\</span>\n-d mongo:3.2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="部署springboot应用" tabindex="-1"><a class="header-anchor" href="#部署springboot应用" aria-hidden="true">#</a> 部署SpringBoot应用</h2><h3 id="构建所有docker镜像并上传" tabindex="-1"><a class="header-anchor" href="#构建所有docker镜像并上传" aria-hidden="true">#</a> 构建所有Docker镜像并上传</h3>',17),t=(0,e._)("li",null,[(0,e._)("p",null,"打开pom.xml中使用docker插件的注释"),(0,e._)("p",null,[(0,e._)("img",{src:"//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/devops/docker/image-20211102114733160.png",alt:"image-20211102114733160"})])],-1),b=(0,e._)("li",null,[(0,e._)("p",null,"修改dockerHost为你自己的docker服务器地址 ip:2375")],-1),m=(0,e._)("p",null,"Docker 开启2375端口：",-1),h={href:"https://www.cnblogs.com/djlsunshine/p/13368127.html",target:"_blank",rel:"noopener noreferrer"},g=(0,e.Uk)("https://www.cnblogs.com/djlsunshine/p/13368127.html"),v=(0,e._)("li",null,"https://blog.csdn.net/u013658328/article/details/108054149",-1),k=(0,e.uE)('<li><p>构建镜像并上传：</p><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/devops/docker/image-20211102114805916.png" alt="image-20211102114805916"></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>REPOSITORY            TAG                 IMAGE ID            CREATED              SIZE\nmall/mall-portal      <span class="token number">1.0</span>-SNAPSHOT        70e0f76416a0        <span class="token number">21</span> seconds ago       705MB\nmall/mall-search      <span class="token number">1.0</span>-SNAPSHOT        f3290bd1d0c7        <span class="token number">41</span> seconds ago       725MB\nmall/mall-admin       <span class="token number">1.0</span>-SNAPSHOT        26557b93a106        About a minute ago   705MB\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li>',1),x=(0,e._)("h2",{id:"参考资料",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#参考资料","aria-hidden":"true"},"#"),(0,e.Uk)(" 参考资料")],-1),y=(0,e._)("ul",null,[(0,e._)("li",null,"http://www.macrozheng.com/#/deploy/mall_deploy_docker"),(0,e._)("li",null,"https://www.thisfaner.com/p/docker-deploy-dev-env/")],-1),f={},q=(0,a(3744).Z)(f,[["render",function(s,n){const a=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[l,(0,e._)("ul",null,[(0,e._)("li",null,[i,(0,e._)("p",null,[r,(0,e._)("a",c,[p,(0,e.Wm)(a)])]),d]),u]),o,(0,e._)("ul",null,[t,b,(0,e._)("li",null,[m,(0,e._)("ul",null,[(0,e._)("li",null,[(0,e._)("a",h,[g,(0,e.Wm)(a)])]),v])]),k]),x,y],64)}]])},3744:(s,n)=>{n.Z=(s,n)=>{for(const[a,e]of n)s[a]=e;return s}}}]);