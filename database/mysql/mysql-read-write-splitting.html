<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <link rel="icon" href="./images/icons/favicon.ico"><title>MySQL - 读写分离 | atips</title><meta name="description" content="整理开发笔记、技巧、文档等">
    <link rel="preload" href="/atips/assets/js/runtime~app.006d820a.js" as="script"><link rel="preload" href="/atips/assets/css/styles.260bed4b.css" as="style"><link rel="preload" href="/atips/assets/js/8567.1b238c3e.js" as="script"><link rel="preload" href="/atips/assets/js/app.f3898035.js" as="script">
    <link rel="stylesheet" href="/atips/assets/css/styles.260bed4b.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/atips/" class=""><!----><span class="site-name">atips</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/atips/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java 基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/basic/java-basic-oop/" class="nav-link" aria-label="Java 面向对象"><!--[--><!--]--> Java 面向对象 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/java/container/collection/java-collection-overview/" class="nav-link" aria-label="Java 集合框架"><!--[--><!--]--> Java 集合框架 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java进阶 - 并发框架</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/concurrent/java-concurrent-overview/" class="nav-link" aria-label="Java 并发知识体系"><!--[--><!--]--> Java 并发知识体系 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java进阶 - 新版本特性</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/java1.8/java-8-features-overview/" class="nav-link" aria-label="Java 8 特性"><!--[--><!--]--> Java 8 特性 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java进阶 - JVM相关</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/jvm/java-jvm-agent-arthas/" class="nav-link" aria-label="Java 调试排错相关"><!--[--><!--]--> Java 调试排错相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>SQL 数据库</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/database/mysql/mysql-commands/" class="nav-link" aria-label="MySQL 数据库"><!--[--><!--]--> MySQL 数据库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>NoSQL 数据库</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/database/nosql-redis/redis-overview/" class="nav-link" aria-label="Redis 数据库"><!--[--><!--]--> Redis 数据库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-mongodb/mongodb-overview/" class="nav-link" aria-label="MongoDB 数据库"><!--[--><!--]--> MongoDB 数据库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-elasticsearch/elasticsearch-overview/" class="nav-link" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="开发"><span class="title">开发</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="开发"><span class="title">开发</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>高并发架构</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/mq/mq-overview/" class="nav-link" aria-label="消息队列"><!--[--><!--]--> 消息队列 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-elasticsearch/elasticsearch-overview/" class="nav-link" aria-label="搜索引擎"><!--[--><!--]--> 搜索引擎 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-redis/redis-overview/" class="nav-link" aria-label="缓存"><!--[--><!--]--> 缓存 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="分库分表"><!--[--><!--]--> 分库分表 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="读写分离"><!--[--><!--]--> 读写分离 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>高可用架构</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="基于Hystrix"><!--[--><!--]--> 基于Hystrix <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>分布式系统</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="分布式锁"><!--[--><!--]--> 分布式锁 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>微服务架构</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="基于Hystrix"><!--[--><!--]--> 基于Hystrix <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/atips/spring/spring-framework/" class="nav-link" aria-label="Spring 基础"><!--[--><!--]--> Spring 基础 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/atips/web/" class="nav-link" aria-label="Web"><!--[--><!--]--> Web <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="开发工具"><span class="title">开发工具</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="开发工具"><span class="title">开发工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>IDE</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/software/ide/idea/basic-course/" class="nav-link" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>其他</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/linux/linux-basic/" class="nav-link" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/software/vcs/git-commit/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/software/postman/" class="nav-link" aria-label="Postman"><!--[--><!--]--> Postman <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/software/maven/" class="nav-link" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/devops/docker/docker-basic/" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/atips/about/about-me/" class="nav-link" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间模式"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/atips/" class="nav-link" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java 基础</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/basic/java-basic-oop/" class="nav-link" aria-label="Java 面向对象"><!--[--><!--]--> Java 面向对象 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/java/container/collection/java-collection-overview/" class="nav-link" aria-label="Java 集合框架"><!--[--><!--]--> Java 集合框架 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java进阶 - 并发框架</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/concurrent/java-concurrent-overview/" class="nav-link" aria-label="Java 并发知识体系"><!--[--><!--]--> Java 并发知识体系 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java进阶 - 新版本特性</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/java1.8/java-8-features-overview/" class="nav-link" aria-label="Java 8 特性"><!--[--><!--]--> Java 8 特性 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>Java进阶 - JVM相关</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/java/jvm/java-jvm-agent-arthas/" class="nav-link" aria-label="Java 调试排错相关"><!--[--><!--]--> Java 调试排错相关 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>SQL 数据库</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/database/mysql/mysql-commands/" class="nav-link" aria-label="MySQL 数据库"><!--[--><!--]--> MySQL 数据库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>NoSQL 数据库</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/database/nosql-redis/redis-overview/" class="nav-link" aria-label="Redis 数据库"><!--[--><!--]--> Redis 数据库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-mongodb/mongodb-overview/" class="nav-link" aria-label="MongoDB 数据库"><!--[--><!--]--> MongoDB 数据库 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-elasticsearch/elasticsearch-overview/" class="nav-link" aria-label="Elasticsearch"><!--[--><!--]--> Elasticsearch <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="开发"><span class="title">开发</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="开发"><span class="title">开发</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>高并发架构</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/mq/mq-overview/" class="nav-link" aria-label="消息队列"><!--[--><!--]--> 消息队列 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-elasticsearch/elasticsearch-overview/" class="nav-link" aria-label="搜索引擎"><!--[--><!--]--> 搜索引擎 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/database/nosql-redis/redis-overview/" class="nav-link" aria-label="缓存"><!--[--><!--]--> 缓存 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="分库分表"><!--[--><!--]--> 分库分表 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="读写分离"><!--[--><!--]--> 读写分离 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>高可用架构</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="基于Hystrix"><!--[--><!--]--> 基于Hystrix <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>分布式系统</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="分布式锁"><!--[--><!--]--> 分布式锁 <!--[--><!--]--></a></li><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>微服务架构</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a aria-current="page" href="/atips/database/mysql/mysql-read-write-splitting.html" class="router-link-active router-link-exact-active nav-link router-link-active" aria-label="基于Hystrix"><!--[--><!--]--> 基于Hystrix <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Spring"><span class="title">Spring</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/atips/spring/spring-framework/" class="nav-link" aria-label="Spring 基础"><!--[--><!--]--> Spring 基础 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/atips/web/" class="nav-link" aria-label="Web"><!--[--><!--]--> Web <!--[--><!--]--></a></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="开发工具"><span class="title">开发工具</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="开发工具"><span class="title">开发工具</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>IDE</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/software/ide/idea/basic-course/" class="nav-link" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="dropdown-item"><!--[--><h4 class="dropdown-subtitle"><span>其他</span></h4><ul class="dropdown-subitem-wrapper"><!--[--><li class="dropdown-subitem"><a href="/atips/linux/linux-basic/" class="nav-link" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/software/vcs/git-commit/" class="nav-link" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/software/postman/" class="nav-link" aria-label="Postman"><!--[--><!--]--> Postman <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/software/maven/" class="nav-link" aria-label="Maven"><!--[--><!--]--> Maven <!--[--><!--]--></a></li><li class="dropdown-subitem"><a href="/atips/devops/docker/docker-basic/" class="nav-link" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a href="/atips/about/about-me/" class="nav-link" aria-label="关于"><!--[--><!--]--> 关于 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">SQL - MySQL</p><ul class=""><li><!--[--><a href="/atips/database/mysql/mysql-commands.html" class="nav-link sidebar-item" aria-label="MySQL - 常用命令"><!--[--><!--]--> MySQL - 常用命令 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/atips/database/mysql/mysql-master-slave.html" class="nav-link sidebar-item" aria-label="MySQL - 主从复制"><!--[--><!--]--> MySQL - 主从复制 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">NoSQL - Redis</p><ul class=""><li><!--[--><a href="/atips/database/nosql-redis/redis-overview.html" class="nav-link sidebar-item" aria-label="Reids - Overview"><!--[--><!--]--> Reids - Overview <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/atips/database/nosql-redis/redis-introduce.html" class="nav-link sidebar-item" aria-label="Redis入门 - 概念和基础"><!--[--><!--]--> Redis入门 - 概念和基础 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/atips/database/nosql-redis/redis-data-types.html" class="nav-link sidebar-item" aria-label="Redis入门 - 数据类型：5种基础数据类型"><!--[--><!--]--> Redis入门 - 数据类型：5种基础数据类型 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/atips/database/nosql-redis/redis-data-types-special.html" class="nav-link sidebar-item" aria-label="Redis入门 - 数据类型：3种特殊类型"><!--[--><!--]--> Redis入门 - 数据类型：3种特殊类型 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">NoSQL - MongoDB</p><ul class=""><li><!--[--><a href="/atips/database/nosql-mongodb/mongodb-overview.html" class="nav-link sidebar-item" aria-label="MongoDB 知识体系"><!--[--><!--]--> MongoDB 知识体系 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/atips/database/nosql-mongodb/mongodb-basic.html" class="nav-link sidebar-item" aria-label="MongoDB入门 - 基础概念"><!--[--><!--]--> MongoDB入门 - 基础概念 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">NoSQL - Elasticsearch</p><ul class=""><li><!--[--><a href="/atips/database/nosql-elasticsearch/elasticsearch-overview.html" class="nav-link sidebar-item" aria-label="ElasticSearch 知识体系"><!--[--><!--]--> ElasticSearch 知识体系 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/atips/database/nosql-elasticsearch/elasticsearch-introduce.html" class="nav-link sidebar-item" aria-label="ES入门 - 介绍"><!--[--><!--]--> ES入门 - 介绍 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/atips/database/nosql-elasticsearch/elasticsearch-install.html" class="nav-link sidebar-item" aria-label="ES安装 - ElasticSearch和Kibana安装"><!--[--><!--]--> ES安装 - ElasticSearch和Kibana安装 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="mysql-读写分离" tabindex="-1"><a class="header-anchor" href="#mysql-读写分离" aria-hidden="true">#</a> MySQL - 读写分离</h1><p><strong>TODO</strong> 此案例由于在打包Docker镜像时go下载的依赖包需要搭梯子，中断了，没有成功搭建。</p><h2 id="什么是读写分离" tabindex="-1"><a class="header-anchor" href="#什么是读写分离" aria-hidden="true">#</a> 什么是读写分离</h2><p><strong>读写分离</strong>：指的是<strong>主服务器</strong>处理<em>写操作</em>以及实时性要求比较高的<em>读操作</em>，而<strong>从服务器</strong>处理<em>读操作</em>。</p><p>读写分离能提高性能的原因在于：</p><ul><li>主从服务器负责各自的读和写，极大程度缓解了锁的争用；</li><li>从服务器可以使用 MyISAM，提升查询性能以及节约系统开销；</li><li>增加冗余，提高可用性。</li></ul><p>读写分离常用代理方式来实现，代理服务器接收应用层传来的读写请求，然后决定转发到哪个服务器。</p><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/image-20211102202811002.png" alt="image-20211102202811002"></p><h2 id="使用中间件实现" tabindex="-1"><a class="header-anchor" href="#使用中间件实现" aria-hidden="true">#</a> 使用中间件实现</h2><blockquote><p>传统的MySql读写分离方案是通过在代码中根据SQL语句的类型动态切换数据源来实现的，那么有没有什么中间件可以自动实现读写分离呢？小米开源的数据库中间件Gaea就可以实现，接下来我们将详细讲解如何使用Gaea来实现MySql的读写分离。</p></blockquote><h3 id="gaea简介" tabindex="-1"><a class="header-anchor" href="#gaea简介" aria-hidden="true">#</a> Gaea简介</h3><p>Gaea 是小米中国区电商研发部研发的基于 MySql 协议的数据库中间件，目前在小米商城大陆和海外得到广泛使用，包括订单、社区、活动等多个业务。Gaea支持分库分表、SQL路由、读写分离等基本特性，其中分库分表方案兼容了 mycat 和 kingshard 两个项目的路由方式。</p><h3 id="mysql主从复制" tabindex="-1"><a class="header-anchor" href="#mysql主从复制" aria-hidden="true">#</a> MySql主从复制</h3><p>使用 Gaea 需要依赖 MySql 的主从复制环境</p><h3 id="直接在linux下安装" tabindex="-1"><a class="header-anchor" href="#直接在linux下安装" aria-hidden="true">#</a> 直接在Linux下安装</h3><blockquote><p>目前官方提供的是在 Linux 下直接安装的方式，我们先按此方法来安装 Gaea。</p></blockquote><h4 id="安装go语言环境" tabindex="-1"><a class="header-anchor" href="#安装go语言环境" aria-hidden="true">#</a> 安装Go语言环境</h4><blockquote><p>由于 Gaea 是使用 Go 语言编写的，所以我们需要先安装Go语言的环境。</p></blockquote><ul><li>安装Go语言环境，下载地址：<a href="https://golang.org/dl/" target="_blank" rel="noopener noreferrer">https://golang.org/dl/<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_01.png" alt=""></p><ul><li>下载完成后解压到 <code>/mydata</code> 目录下；</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf go1.13.5.linux-amd64.tar.gz -C /mydata/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>添加 <code>/mydata/go/bin</code> 目录到 PATH 变量中：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 编辑环境变量配置文件</span>
<span class="token function">vim</span> /etc/profile

<span class="token comment"># 在最后一行添加如下配置</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOROOT</span><span class="token operator">=</span>/mydata/go
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$GOROOT</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://athens.azurefd.net

<span class="token comment"># 刷新配置文件</span>
<span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>查看版本号，测试是否安装成功：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>go version
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>返回以下信息表示Go语言环境已经安装成功了：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>go version go1.13.5 linux/amd64
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h4 id="安装gaea" tabindex="-1"><a class="header-anchor" href="#安装gaea" aria-hidden="true">#</a> 安装Gaea</h4><blockquote><p>由于Gaea并没有提供安装包，所以我们需要自行编译源码获取可执行文件。</p></blockquote><ul><li>下载Gaea的源码，直接下载 <code>tar.gz</code> 包到 <code>/mydata</code> 目录下，然后解压，下载地址：https://github.com/XiaoMi/Gaea</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf Gaea-1.2.2.tar.gz
<span class="token function">rm</span> -rf Gaea-1.2.2.tar.gz
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>进入 <code>/mydata/Gaea-1.2.2/</code> 目录下，使用 <code>make</code> 命令对源码编译：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> Gaea-1.2.2 <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> build
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p><strong>注意</strong>：由于网络问题，某些 Go 的依赖会下载不下来导致编译失败，多尝试几次即可成功；</p><p>如果报错：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cgo: C compiler &quot;gcc&quot; not found: exec: &quot;gcc&quot;: executable file not found in $PATH
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>则需要安装 gcc ，安装命令：<code>yum install gcc</code></p><ul><li><p>编译完成后在 <code>/mydata/Gaea-1.2.2/bin</code> 目录下会生成 Gaea 的执行文件 <code>gaea</code>：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@xx mydata<span class="token punctuation">]</span><span class="token comment"># ll /mydata/Gaea-1.2.2/bin/</span>
总用量 <span class="token number">40540</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">23874237</span> <span class="token number">11</span>月  <span class="token number">3</span> <span class="token number">13</span>:26 gaea
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">17635041</span> <span class="token number">11</span>月  <span class="token number">3</span> <span class="token number">13</span>:26 gaea-cc
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>由于我们没有搭建 <code>etcd </code>配置中心，所以需要修改本地配置文件 <code>/mydata/Gaea-1.2.2/etc/gaea.ini</code>，将配置类型改为 <code>file</code>：<code>tar -zcvf Gaea-master.tar.gz Gaea-1.2.2</code></p></li></ul><div class="language-ini ext-ini line-numbers-mode"><pre class="language-ini"><code><span class="token comment">; 配置类型，目前支持file/etcd两种方式，file方式不支持热加载</span>
<span class="token key attr-name">config_type</span><span class="token punctuation">=</span><span class="token value attr-value">file</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>添加namespace配置文件，用于配置我们的主从数据库信息，配置文件地址：<code>/mydata/Gaea-1.2.2/etc/file/namespace/mall_namespace_1.json</code></p></li><li><p>配置文件内容如下：</p></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mall_namespace_1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;online&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;read_only&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowed_dbs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;mall&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;slow_sql_time&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1000&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;black_sql&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowed_ip&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;slices&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;slice-0&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;user_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;master&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.220.132:3307&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;slaves&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.220.132:3308&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;statistic_slaves&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">&quot;capacity&quot;</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
            <span class="token property">&quot;max_capacity&quot;</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
            <span class="token property">&quot;idle_timeout&quot;</span><span class="token operator">:</span> <span class="token number">60</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;shard_rules&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;users&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;user_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;macro&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;namespace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mall_namespace_1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;rw_flag&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">&quot;rw_split&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">&quot;other_property&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_slice&quot;</span><span class="token operator">:</span> <span class="token string">&quot;slice-0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;global_sequences&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="namespace配置文件" tabindex="-1"><a class="header-anchor" href="#namespace配置文件" aria-hidden="true">#</a> namespace配置文件</h4><blockquote><p>namespace的配置格式为json，包含分表、非分表、实例等配置信息，都可在运行时改变。</p></blockquote><ul><li><p>整体配置说明：</p><table><thead><tr><th>字段名称</th><th>字段类型</th><th>字段含义</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>namespace名称</td></tr><tr><td>online</td><td>bool</td><td>是否在线，逻辑上下线使用</td></tr><tr><td>read_only</td><td>bool</td><td>是否只读，namespace级别</td></tr><tr><td>allowed_dbs</td><td>map</td><td>允许通过代理访问的数据库</td></tr><tr><td>default_phy_dbs</td><td>map</td><td>默认数据库名, 与allowed_dbs一一对应</td></tr><tr><td>slow_sql_time</td><td>string</td><td>慢sql时间，单位ms</td></tr><tr><td>black_sql</td><td>string数组</td><td>黑名单sql</td></tr><tr><td>allowed_ip</td><td>string数组</td><td>白名单IP</td></tr><tr><td>slices</td><td>map数组</td><td>一主多从的物理实例，slice里map的具体字段可参照slice配置</td></tr><tr><td>shard_rules</td><td>map数组</td><td>分库、分表、特殊表的配置内容，具体字段可参照shard配置</td></tr><tr><td>users</td><td>map数组</td><td>应用端连接gaea所需要的用户配置，具体字段可参照users配置</td></tr></tbody></table></li><li><p>slice配置：</p><table><thead><tr><th>字段名称</th><th>字段类型</th><th>字段含义</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>分片名称，自动、有序生成</td></tr><tr><td>user_name</td><td>string</td><td>数据库用户名</td></tr><tr><td>password</td><td>string</td><td>数据库密码</td></tr><tr><td>master</td><td>string</td><td>主实例地址</td></tr><tr><td>slaves</td><td>string数组</td><td>从数据库地址，可以配置多个</td></tr><tr><td>statistic_slaves</td><td>string数组</td><td>统计型从实例地址列表</td></tr><tr><td>capacity</td><td>int</td><td>gaea_proxy与每个实例的连接池大小</td></tr><tr><td>max_capacity</td><td>int</td><td>gaea_proxy与每个实例的连接池最大大小</td></tr><tr><td>idle_timeout</td><td>int</td><td>gaea_proxy与后端mysql空闲连接存活时间，单位:秒</td></tr></tbody></table></li><li><p>users配置：</p><table><thead><tr><th>字段名称</th><th>字段类型</th><th>字段含义</th></tr></thead><tbody><tr><td>user_name</td><td>string</td><td>数据库代理用户名，客户端通过该用户名访问</td></tr><tr><td>password</td><td>string</td><td>数据库代理密码，客户端通过该用户名访问</td></tr><tr><td>namespace</td><td>string</td><td>对应的命名空间</td></tr><tr><td>rw_flag</td><td>int</td><td>读写标识, 只读=1, 读写=2</td></tr><tr><td>rw_split</td><td>int</td><td>是否读写分离, 非读写分离=0, 读写分离=1</td></tr><tr><td>other_property</td><td>int</td><td>目前用来标识是否走统计从实例, 普通用户=0, 统计用户=1</td></tr></tbody></table></li></ul><h3 id="在docker容器中运行" tabindex="-1"><a class="header-anchor" href="#在docker容器中运行" aria-hidden="true">#</a> 在Docker容器中运行</h3><blockquote><p>由于官方只提供了Linux下直接安装运行的方式，这里我们提供另一种运行方式，在Docker容器中作为服务运行。</p></blockquote><h4 id="打包成docker镜像" tabindex="-1"><a class="header-anchor" href="#打包成docker镜像" aria-hidden="true">#</a> 打包成Docker镜像</h4><blockquote><p>Docker Hub 中并没有打包好的Gaea镜像，我们需要自行构建一个，下面详细介绍下如何构建Gaea的Docker镜像。</p></blockquote><ul><li>这里我们使用Dockerfile构建Docker镜像，Dockerfile中的内容如下：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 创建Dockerfile</span>
<span class="token function">touch</span> /mydata/Dockerfile
<span class="token function">vi</span> /mydata/Dockerfile
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>添加配置：</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token comment"># 该镜像需要依赖的基础镜像</span>
<span class="token instruction"><span class="token keyword">FROM</span> golang:latest</span>
<span class="token comment"># 将当前目录下的gaea源码包复制到docker容器的/go/Gaea-master目录下，对于.tar.gz文件会自动解压</span>
<span class="token instruction"><span class="token keyword">ADD</span> Gaea-1.2.2.tar.gz /go/Gaea-master</span>
<span class="token comment"># 将解压后的源码移动到docker内容的/go/gaea目录中去</span>
<span class="token instruction"><span class="token keyword">RUN</span> bash -c <span class="token string">&#39;mv /go/Gaea-master/Gaea-1.2.2 /go/gaea&#39;</span></span>
<span class="token comment"># 进入docker内的/go/gaea目录</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /go/gaea</span>
<span class="token comment"># 将gaea源码进行打包编译</span>
<span class="token instruction"><span class="token keyword">RUN</span> bash -c <span class="token string">&#39;make build&#39;</span></span>
<span class="token comment"># 声明服务运行在13306端口</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 13306</span>
<span class="token comment"># 指定docker容器启动时执行的命令</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;/go/gaea/bin/gaea&quot;</span>]</span>
<span class="token comment"># 指定维护者的名字</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> yolo</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>注意：Gaea-1.2.2.tar.gz 也是在 <code>/mydata</code> 目录下</p><ul><li>之后使用Docker命令构建Gaea的Docker镜像，在 <code>/mydata</code> 目录下执行（这个过程需使用梯子）：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker build -t gaea:1.2.2 <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>构建成功控制台输出：</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_12.png" alt=""></p><ul><li>将本地安装的Gaea配置文件复制到<code>/mydata/gaea-docker/etc/</code>目录下：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cp</span> -r /mydata/gaea/etc/ /mydata/gaea-docker/etc/
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>使用Docker命令启动Gaea容器：</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker run -p <span class="token number">13306</span>:13306 --name gaea <span class="token punctuation">\</span>
-v /mydata/gaea-docker/etc:/go/gaea/etc <span class="token punctuation">\</span>
-d gaea:1.2.2
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="测试读写分离" tabindex="-1"><a class="header-anchor" href="#测试读写分离" aria-hidden="true">#</a> 测试读写分离</h3><blockquote><p>测试思路：首先我们关闭从实例的主从复制，然后通过Gaea代理来操作数据库，插入一条数据，如果主实例中有这条数据而从实例中没有，说明写操作是走的主库。然后再通过Gaea代理查询该表数据，如果没有这条数据，表示读操作走的是从库，证明读写分离成功。</p></blockquote><ul><li>通过Navicat连接到Gaea代理，注意此处账号密码为Gaea的namespace中配置的内容，端口为Gaea的服务端口；</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_05.png" alt=""></p><ul><li>通过Navicat分别连接到主库和从库，用于查看数据，此时建立了以下三个数据库连接；</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_06.png" alt=""></p><ul><li>通过<code>stop slave</code>命令关闭<code>mysql-slave</code>实例的主从复制功能：</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_07.png" alt=""></p><ul><li>通过Gaea代理在<code>test</code>表中插入一条数据：</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_08.png" alt=""></p><ul><li>在主库中查看<code>test</code>表的数据，发现已有该数据：</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_09.png" alt=""></p><ul><li>在从库中查看<code>test</code>表的数据，发现没有该数据，证明写操作走的是主库：</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_10.png" alt=""></p><ul><li>直接在代理中查看<code>test</code>表中的数据，发现没有该数据，证明读操作走的是从库。</li></ul><p><img src="//gcore.jsdelivr.net/gh/tiancixiong/atips@img-230529/images/database/mysql/gaea_use_11.png" alt=""></p><h3 id="结合springboot使用" tabindex="-1"><a class="header-anchor" href="#结合springboot使用" aria-hidden="true">#</a> 结合SpringBoot使用</h3><p>在我们的SpringBoot应用中，我们只需要把Gaea的代理服务直接当做数据库服务来使用就可以实现读写分离了。这样就不用在代码中添加任何读写分离逻辑了，是不是很方便！</p><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2><ul><li><p>http://www.macrozheng.com/#/reference/gaea</p></li><li><p>gaea官方文档：https://github.com/XiaoMi/Gaea</p></li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/tiancixiong/atips/edit/master/docs/database/mysql/mysql-read-write-splitting.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页"><!--[--><!--]--> 在 GitHub 上编辑此页 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><span class="meta-item-info">2024/7/1 12:20:12</span></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: tiancixiong@163.com">Tianci.Xiong</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: tiancixiong@163.com">TianCi.Xiong</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/atips/assets/js/runtime~app.006d820a.js" defer></script><script src="/atips/assets/js/8567.1b238c3e.js" defer></script><script src="/atips/assets/js/app.f3898035.js" defer></script>
  </body>
</html>
